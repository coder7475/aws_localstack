# **Day 2 â€“ Learning Plan: Amazon S3 Basics**

### **Goal:**

Learn the basics of **Amazon S3 (Simple Storage Service)** by practicing bucket operations, file uploads, and downloads with LocalStack.

---

### **Tasks / Jobs for Day 2**

1. **Start LocalStack (if not running)**

```bash
docker compose up -d
```

2. **Create an S3 Bucket**

```bash
aws --endpoint-url=http://localhost:4566 s3 mb s3://my-first-bucket --profile localstack
```

3. **List Buckets**

```bash
aws --endpoint-url=http://localhost:4566 s3 ls --profile localstack
```

4. **Upload a File**

```bash
echo "Hello AWS with LocalStack!" > test.txt
aws --endpoint-url=http://localhost:4566 s3 cp test.txt s3://my-first-bucket/ --profile localstack
```

5. **List Objects in the Bucket**

```bash
aws --endpoint-url=http://localhost:4566 s3 ls s3://my-first-bucket --profile localstack
```

6. **Download the File Back**

```bash
aws --endpoint-url=http://localhost:4566 s3 cp s3://my-first-bucket/test.txt ./downloaded.txt --profile localstack
cat downloaded.txt
```

7. **Delete the Object**

```bash
aws --endpoint-url=http://localhost:4566 s3 rm s3://my-first-bucket/test.txt --profile localstack
```

8. **Remove the Bucket**

```bash
aws --endpoint-url=http://localhost:4566 s3 rb s3://my-first-bucket --profile localstack
```

---

### **Learning Outcomes**

- Understand S3 buckets and objects.
- Practice creating, uploading, downloading, and deleting files.
- Get comfortable using AWS CLI with LocalStack for S3.

## Learn More

- https://medium.com/edureka/s3-aws-amazon-simple-storage-service-aa71c664b465

## **Day 3 â€“ Steps**

### **1. Start LocalStack**

Make sure LocalStack is running (via Docker or `localstack` CLI).

```bash
docker compose up  -d
```

Check status:

```bash
docker compose logs -f localstack
```

---

### **2. Create an S3 Bucket**

```bash
aws --endpoint-url=http://localhost:4566 s3 mb s3://my-versioned-bucket --profile localstack
```

---

### **3. Enable Versioning**

```bash
aws --endpoint-url=http://localhost:4566 s3api put-bucket-versioning \
  --bucket my-versioned-bucket \
  --versioning-configuration Status=Enabled \
  --profile localstack
```

Verify:

```bash
aws --endpoint-url=http://localhost:4566 s3api get-bucket-versioning --bucket my-versioned-bucket --profile localstack
```

---

### **4. Upload Multiple Versions of a File**

```bash
echo "First version" > file.txt
aws --endpoint-url=http://localhost:4566 s3 cp file.txt s3://my-versioned-bucket/file.txt --profile localstack

echo "Second version" > file.txt
aws --endpoint-url=http://localhost:4566 s3 cp file.txt s3://my-versioned-bucket/file.txt --profile localstack
```

---

### **5. List Object Versions**

```bash
aws --endpoint-url=http://localhost:4566 s3api list-object-versions --bucket my-versioned-bucket --profile localstack
```

Youâ€™ll see multiple versions of `file.txt` with different `VersionId`s.

---

### **6. Retrieve a Specific Version**

```bash
aws --endpoint-url=http://localhost:4566 s3api get-object \
  --bucket my-versioned-bucket \
  --key file.txt \
  --version-id <VERSION_ID> output.txt \
  --profile localstack
```

Example VersionID: 'AZlhVz9uuncCBeWZe4U4SgUDku1rpd8\_'

---

Sure! Letâ€™s expand **Step 7 â€“ Add a Lifecycle Policy** with more **context, explanation, and details** so itâ€™s clear why and how youâ€™re doing each part.

---

Hereâ€™s a **fixed and fully LocalStack-compatible version** of your Day 3 lifecycle policy guide. I updated the JSON structure using the **`Filter` object with `Prefix`**, added **`AbortIncompleteMultipartUpload`** (needed in LocalStack), and polished explanations. This should now work without `MalformedXML` errors.

---

### **7. Add a Lifecycle Policy**

**Purpose:**  
Lifecycle policies in S3 help **automate object management**, such as deleting old versions, transitioning storage classes, or cleaning up temporary data. This is useful for **cost optimization** and keeping your bucket organized.

---

### **Step 1: Create a JSON file for the policy**

Create a file named `lifecycle.json` with the following content:

```json
{
  "Rules": [
    {
      "ID": "ExpireOldVersions",
      "Filter": {
        "Prefix": ""
      },
      "Status": "Enabled",
      "NoncurrentVersionExpiration": {
        "NoncurrentDays": 1
      },
      "AbortIncompleteMultipartUpload": {
        "DaysAfterInitiation": 7
      }
    }
  ]
}
```

**Explanation of fields:**

- `"ID"`: Name of the rule for identification.
- `"Filter"`: Specifies the object prefix this rule applies to. Empty string (`""`) applies to all objects.
- `"Status"`: Must be `"Enabled"` to activate the rule.
- `"NoncurrentVersionExpiration"`: Deletes **older versions** of objects after `NoncurrentDays`. (Set to `1` day for testing in LocalStack.)
- `"AbortIncompleteMultipartUpload"`: Automatically cleans up incomplete uploads after 7 days (required in LocalStack to avoid validation errors).

---

### **Step 2: Apply the lifecycle configuration to the bucket**

**Multi-line command (Linux/macOS/Bash):**

```bash
aws --endpoint-url=http://localhost:4566 s3api put-bucket-lifecycle-configuration \
  --bucket my-versioned-bucket \
  --lifecycle-configuration file://lifecycle.json \
  --profile localstack
```

**Single-line command (works anywhere):**

```bash
aws --endpoint-url=http://localhost:4566 s3api put-bucket-lifecycle-configuration --bucket my-versioned-bucket --lifecycle-configuration file://lifecycle.json --profile localstack
```

**What this does:**

- Reads `lifecycle.json` and applies it to `my-versioned-bucket`.
- Any old object versions (older than 1 day) will now be automatically deleted.
- Incomplete multipart uploads older than 7 days will also be removed.

---

### **Step 3: Verify the lifecycle policy**

```bash
aws --endpoint-url=http://localhost:4566 s3api get-bucket-lifecycle-configuration \
  --bucket my-versioned-bucket \
  --profile localstack
```

**Expected output:**  
You should see your lifecycle rule in JSON format, confirming itâ€™s active.

---

### **Optional Tips**

You can define **multiple rules** in a single `lifecycle.json` for:

- Deleting expired objects automatically
- Transitioning objects to cheaper storage classes (e.g., `STANDARD_IA`, `GLACIER`)
- Managing both current and noncurrent object versions

---

ðŸ’¡ **Note for LocalStack users:**

- Always include `Filter` with `Prefix` and `AbortIncompleteMultipartUpload`.
- Use small numbers (`1`) for `NoncurrentDays` while testing to quickly observe results.
